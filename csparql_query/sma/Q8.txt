CONSTRUCT {
	_:c0 <http://purl.oclc.org/NET/sao/hasValue> ?congestion .
	_:c0 <http://purl.oclc.org/NET/ssnx/ssn#observedProperty> _:c1 .
	_:c0 <http://www.w3.org/1999/02/22-rdf-syntax-ns#type> <http://www.insight-centre.org/citytraffic#congestionLevel> .
	_:c1 <http://www.insight-centre.org/citytraffic#hasStartLatitude> ?lat1 .
	_:c1 <http://www.insight-centre.org/citytraffic#hasStartLongitude> ?lng1 .
	_:c2 <http://www.w3.org/1999/02/22-rdf-syntax-ns#type> <http://www.insight-centre.org/citytraffic#userPosition> .
	_:c2 <http://www.insight-centre.org/citytraffic#hasLatitude> ?avglat .
	_:c2 <http://www.insight-centre.org/citytraffic#hasLongitude> ?avglng .
	_:c3 <http://purl.oclc.org/NET/sao/hasValue> ?parkingCapacity .
	_:c3 <http://purl.oclc.org/NET/ssnx/ssn#observedProperty> _:c4 .
	_:c3 <http://www.w3.org/1999/02/22-rdf-syntax-ns#type> <http://www.insight-centre.org/citytraffic#ParkingVacancy> .
	_:c3 <http://www.insight-centre.org/citytraffic#hasStartLatitude> ?lat4 .
	_:c3 <http://www.insight-centre.org/citytraffic#hasStartLongitude> ?lng4 .
} 

 from stream <http://www.insight-centre.org/dataset/SampleEventService#AarhusTrafficData0> [range 10s step 10s]
 from stream <http://www.insight-centre.org/dataset/SampleEventService#UserLocationService> [range 10s step 10s]
 from stream <http://www.insight-centre.org/dataset/SampleEventService#AarhusParkingData0> [range 10s step 10s]
where {

?p1   a <http://www.insight-centre.org/citytraffic#CongestionLevel>.
?p1 <http://purl.oclc.org/NET/ssnx/ssn#isPropertyOf> ?v2.
?v2 <http://www.insight-centre.org/citytraffic#hasStartLatitude> ?lat1.
?v2 <http://www.insight-centre.org/citytraffic#hasStartLongitude> ?lng1.
?v2 <http://www.insight-centre.org/citytraffic#hasEndLatitude> ?lat2.
?v2 <http://www.insight-centre.org/citytraffic#hasEndLongitude> ?lng2.

?p4   a <http://www.insight-centre.org/citytraffic#ParkingVacancy>.
?p4 <http://purl.oclc.org/NET/ssnx/ssn#isPropertyOf> ?foi4.
?foi4 <http://www.insight-centre.org/citytraffic#hasStartLatitude> ?lat4.
?foi4 <http://www.insight-centre.org/citytraffic#hasStartLongitude> ?lng4.

{
	?obId1 <http://purl.oclc.org/NET/ssnx/ssn#observedProperty> ?p1.
	?obId1 <http://purl.oclc.org/NET/sao/hasValue> ?congestion.
	?obId1 <http://purl.oclc.org/NET/ssnx/ssn#observedBy> <http://www.insight-centre.org/dataset/SampleEventService#AarhusTrafficData0>.
}

{ select ( AVG (?lat3 ) AS ?avglat ) ( AVG (?lng3 ) AS ?avglng ) 
	where 
	{ 
	?obId3 a ?ob.
	?obId3 <http://purl.oclc.org/NET/sao/hasValue> ?v3.
	?v3 <http://www.insight-centre.org/citytraffic#hasLatitude> ?lat3.
	?v3 <http://www.insight-centre.org/citytraffic#hasLongitude> ?lng3.
	?obId3 <http://purl.oclc.org/NET/ssnx/ssn#observedBy> <http://www.insight-centre.org/dataset/SampleEventService#UserLocationService>.
	}
}

{
	?obId4 <http://purl.oclc.org/NET/ssnx/ssn#observedProperty> ?p4.
	?obId4 <http://purl.oclc.org/NET/sao/hasValue> ?parkingCapacity.
	?obId4 <http://purl.oclc.org/NET/ssnx/ssn#observedBy> <http://www.insight-centre.org/dataset/SampleEventService#AarhusParkingData0>.
}

Filter (((?avglat-?lat1)*(?avglat-?lat1)+(?avglng-?lng1)*(?avglng-?lng1)) < 0.4 && ((?avglat-?lat4)*(?avglat-?lat4)+(?avglng-?lng4)*(?avglng-?lng4)) < 0.4)

}